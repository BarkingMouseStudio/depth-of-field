<!DOCTYPE html><html><head><meta charset="utf-8"><style>body {width: 45em; border: 1px solid #ddd; outline: 1300px solid #fff; margin: 16px auto; } body .markdown-body {padding: 30px; } @font-face {font-family: octicons-anchor; src: url(data:font/woff;charset=utf-8;base64,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) format('woff'); } .markdown-body {font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; color: #333333; overflow: hidden; font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif; font-size: 16px; line-height: 1.6; word-wrap: break-word; } .markdown-body a {background: transparent; } .markdown-body a:active, .markdown-body a:hover {outline: 0; } .markdown-body strong {font-weight: bold; } .markdown-body h1 {font-size: 2em; margin: 0.67em 0; } .markdown-body img {border: 0; } .markdown-body hr {-moz-box-sizing: content-box; box-sizing: content-box; height: 0; } .markdown-body pre {overflow: auto; } .markdown-body code, .markdown-body kbd, .markdown-body pre {font-family: monospace, monospace; font-size: 1em; } .markdown-body input {color: inherit; font: inherit; margin: 0; } .markdown-body html input[disabled] {cursor: default; } .markdown-body input {line-height: normal; } .markdown-body input[type="checkbox"] {box-sizing: border-box; padding: 0; } .markdown-body table {border-collapse: collapse; border-spacing: 0; } .markdown-body td, .markdown-body th {padding: 0; } .markdown-body * {-moz-box-sizing: border-box; box-sizing: border-box; } .markdown-body input {font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; line-height: 1.4; } .markdown-body a {color: #4183c4; text-decoration: none; } .markdown-body a:hover, .markdown-body a:focus, .markdown-body a:active {text-decoration: underline; } .markdown-body hr {height: 0; margin: 15px 0; overflow: hidden; background: transparent; border: 0; border-bottom: 1px solid #ddd; } .markdown-body hr:before, .markdown-body hr:after {display: table; content: " "; } .markdown-body hr:after {clear: both; } .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 {margin-top: 15px; margin-bottom: 15px; line-height: 1.1; } .markdown-body h1 {font-size: 30px; } .markdown-body h2 {font-size: 21px; } .markdown-body h3 {font-size: 16px; } .markdown-body h4 {font-size: 14px; } .markdown-body h5 {font-size: 12px; } .markdown-body h6 {font-size: 11px; } .markdown-body blockquote {margin: 0; } .markdown-body ul, .markdown-body ol {padding: 0; margin-top: 0; margin-bottom: 0; } .markdown-body ol ol, .markdown-body ul ol {list-style-type: lower-roman; } .markdown-body ul ul ol, .markdown-body ul ol ol, .markdown-body ol ul ol, .markdown-body ol ol ol {list-style-type: lower-alpha; } .markdown-body dd {margin-left: 0; } .markdown-body code, .markdown-body pre {font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; font-size: 12px; } .markdown-body pre {margin-top: 0; margin-bottom: 0; } .markdown-body kbd {background-color: #e7e7e7; background-image: -moz-linear-gradient(#fefefe, #e7e7e7); background-image: -webkit-linear-gradient(#fefefe, #e7e7e7); background-image: linear-gradient(#fefefe, #e7e7e7); background-repeat: repeat-x; border-radius: 2px; border: 1px solid #cfcfcf; color: #000; padding: 3px 5px; line-height: 10px; font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace; display: inline-block; } .markdown-body>*:first-child {margin-top: 0 !important; } .markdown-body>*:last-child {margin-bottom: 0 !important; } .markdown-body .anchor {position: absolute; top: 0; bottom: 0; left: 0; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; } .markdown-body .anchor:focus {outline: none; } .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 {position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; } .markdown-body h1 .octicon-link, .markdown-body h2 .octicon-link, .markdown-body h3 .octicon-link, .markdown-body h4 .octicon-link, .markdown-body h5 .octicon-link, .markdown-body h6 .octicon-link {display: none; color: #000; vertical-align: middle; } .markdown-body h1:hover .anchor, .markdown-body h2:hover .anchor, .markdown-body h3:hover .anchor, .markdown-body h4:hover .anchor, .markdown-body h5:hover .anchor, .markdown-body h6:hover .anchor {height: 1em; padding-left: 8px; margin-left: -30px; line-height: 1; text-decoration: none; } .markdown-body h1:hover .anchor .octicon-link, .markdown-body h2:hover .anchor .octicon-link, .markdown-body h3:hover .anchor .octicon-link, .markdown-body h4:hover .anchor .octicon-link, .markdown-body h5:hover .anchor .octicon-link, .markdown-body h6:hover .anchor .octicon-link {display: inline-block; } .markdown-body h1 {padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid #eee; } .markdown-body h2 {padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid #eee; } .markdown-body h3 {font-size: 1.5em; line-height: 1.43; } .markdown-body h4 {font-size: 1.25em; } .markdown-body h5 {font-size: 1em; } .markdown-body h6 {font-size: 1em; color: #777; } .markdown-body p, .markdown-body blockquote, .markdown-body ul, .markdown-body ol, .markdown-body dl, .markdown-body table, .markdown-body pre {margin-top: 0; margin-bottom: 16px; } .markdown-body hr {height: 4px; padding: 0; margin: 16px 0; background-color: #e7e7e7; border: 0 none; } .markdown-body ul, .markdown-body ol {padding-left: 2em; } .markdown-body ul ul, .markdown-body ul ol, .markdown-body ol ol, .markdown-body ol ul {margin-top: 0; margin-bottom: 0; } .markdown-body li>p {margin-top: 16px; } .markdown-body dl {padding: 0; } .markdown-body dl dt {padding: 0; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; } .markdown-body dl dd {padding: 0 16px; margin-bottom: 16px; } .markdown-body blockquote {padding: 0 15px; color: #777; border-left: 4px solid #ddd; } .markdown-body blockquote>:first-child {margin-top: 0; } .markdown-body blockquote>:last-child {margin-bottom: 0; } .markdown-body table {display: block; width: 100%; overflow: auto; word-break: normal; word-break: keep-all; } .markdown-body table th {font-weight: bold; } .markdown-body table th, .markdown-body table td {padding: 6px 13px; border: 1px solid #ddd; } .markdown-body table tr {background-color: #fff; border-top: 1px solid #ccc; } .markdown-body table tr:nth-child(2n) {background-color: #f8f8f8; } .markdown-body img {max-width: 100%; -moz-box-sizing: border-box; box-sizing: border-box; } .markdown-body code {padding: 0; padding-top: 0.2em; padding-bottom: 0.2em; margin: 0; font-size: 85%; background-color: rgba(0,0,0,0.04); border-radius: 3px; } .markdown-body code:before, .markdown-body code:after {letter-spacing: -0.2em; content: "\00a0"; } .markdown-body pre>code {padding: 0; margin: 0; font-size: 100%; word-break: normal; white-space: pre; background: transparent; border: 0; } .markdown-body .highlight {margin-bottom: 16px; } .markdown-body .highlight pre, .markdown-body pre {padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; background-color: #f7f7f7; border-radius: 3px; } .markdown-body .highlight pre {margin-bottom: 0; word-break: normal; } .markdown-body pre {word-wrap: normal; } .markdown-body pre code {display: inline; max-width: initial; padding: 0; margin: 0; overflow: initial; line-height: inherit; word-wrap: normal; background-color: transparent; border: 0; } .markdown-body pre code:before, .markdown-body pre code:after {content: normal; } .markdown-body .highlight {background: #ffffff; } .markdown-body .highlight .c {color: #999988; font-style: italic; } .markdown-body .highlight .err {color: #a61717; background-color: #e3d2d2; } .markdown-body .highlight .k {font-weight: bold; } .markdown-body .highlight .o {font-weight: bold; } .markdown-body .highlight .cm {color: #999988; font-style: italic; } .markdown-body .highlight .cp {color: #999999; font-weight: bold; } .markdown-body .highlight .c1 {color: #999988; font-style: italic; } .markdown-body .highlight .cs {color: #999999; font-weight: bold; font-style: italic; } .markdown-body .highlight .gd {color: #000000; background-color: #ffdddd; } .markdown-body .highlight .gd .x {color: #000000; background-color: #ffaaaa; } .markdown-body .highlight .ge {font-style: italic; } .markdown-body .highlight .gr {color: #aa0000; } .markdown-body .highlight .gh {color: #999999; } .markdown-body .highlight .gi {color: #000000; background-color: #ddffdd; } .markdown-body .highlight .gi .x {color: #000000; background-color: #aaffaa; } .markdown-body .highlight .go {color: #888888; } .markdown-body .highlight .gp {color: #555555; } .markdown-body .highlight .gs {font-weight: bold; } .markdown-body .highlight .gu {color: #800080; font-weight: bold; } .markdown-body .highlight .gt {color: #aa0000; } .markdown-body .highlight .kc {font-weight: bold; } .markdown-body .highlight .kd {font-weight: bold; } .markdown-body .highlight .kn {font-weight: bold; } .markdown-body .highlight .kp {font-weight: bold; } .markdown-body .highlight .kr {font-weight: bold; } .markdown-body .highlight .kt {color: #445588; font-weight: bold; } .markdown-body .highlight .m {color: #009999; } .markdown-body .highlight .s {color: #dd1144; } .markdown-body .highlight .n {color: #333333; } .markdown-body .highlight .na {color: teal; } .markdown-body .highlight .nb {color: #0086b3; } .markdown-body .highlight .nc {color: #445588; font-weight: bold; } .markdown-body .highlight .no {color: teal; } .markdown-body .highlight .ni {color: purple; } .markdown-body .highlight .ne {color: #990000; font-weight: bold; } .markdown-body .highlight .nf {color: #990000; font-weight: bold; } .markdown-body .highlight .nn {color: #555555; } .markdown-body .highlight .nt {color: navy; } .markdown-body .highlight .nv {color: teal; } .markdown-body .highlight .ow {font-weight: bold; } .markdown-body .highlight .w {color: #bbbbbb; } .markdown-body .highlight .mf {color: #009999; } .markdown-body .highlight .mh {color: #009999; } .markdown-body .highlight .mi {color: #009999; } .markdown-body .highlight .mo {color: #009999; } .markdown-body .highlight .sb {color: #dd1144; } .markdown-body .highlight .sc {color: #dd1144; } .markdown-body .highlight .sd {color: #dd1144; } .markdown-body .highlight .s2 {color: #dd1144; } .markdown-body .highlight .se {color: #dd1144; } .markdown-body .highlight .sh {color: #dd1144; } .markdown-body .highlight .si {color: #dd1144; } .markdown-body .highlight .sx {color: #dd1144; } .markdown-body .highlight .sr {color: #009926; } .markdown-body .highlight .s1 {color: #dd1144; } .markdown-body .highlight .ss {color: #990073; } .markdown-body .highlight .bp {color: #999999; } .markdown-body .highlight .vc {color: teal; } .markdown-body .highlight .vg {color: teal; } .markdown-body .highlight .vi {color: teal; } .markdown-body .highlight .il {color: #009999; } .markdown-body .highlight .gc {color: #999; background-color: #EAF2F5; } .markdown-body .octicon {font: normal normal 16px octicons-anchor; line-height: 1; display: inline-block; text-decoration: none; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } .markdown-body .octicon-link:before {content: '\f05c'; } .markdown-body .task-list-item {list-style-type: none; } .markdown-body .task-list-item+.task-list-item {margin-top: 3px; } .markdown-body .task-list-item input {margin: 0 4px 0.25em -20px; vertical-align: middle; } </style><title>README.md</title></head><body><article class="markdown-body"><h2> <a name="user-content-documentation" class="anchor" href="#documentation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Documentation</h2> <h3> <a name="user-content-setting-up-the-camera" class="anchor" href="#setting-up-the-camera" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting up the camera</h3> <ol> <li><p>Add DepthOfField.cs to the camera you wish to apply depth of field. While you can adjust parameters at any time we recommend finishing the setup so you can preview your changes.</p></li> <li><p>Make sure you set your camera's clear flag to something other than "Depth".</p></li> </ol><h3> <a name="user-content-modifying-your-shaders" class="anchor" href="#modifying-your-shaders" aria-hidden="true"><span class="octicon octicon-link"></span></a>Modifying your shaders</h3> <p>When in doubt we provide a number of example shaders in DepthOfField/Example/Shaders/ that demonstrates a fully working surface and vertex/fragment shaders.</p> <blockquote> <p>NOTE: ShaderLab syntax is not supported since they do not support vertex functions.</p> </blockquote> <h4> <a name="user-content-surface-shaders" class="anchor" href="#surface-shaders" aria-hidden="true"><span class="octicon octicon-link"></span></a>Surface Shaders</h4> <ol> <li> <p>Add the DepthCG.cginc include just after your surface pragma. This will import the necessary helper function for calculating distance from the camera. If you already have includes, DepthCG should be first.</p> <div class="highlight highlight-glsl"><pre><span class="cp">#pragma surface surf Lambert vertex:vert</span> <span class="cp">#include "DepthCG.cginc" // &lt;= HERE</span> </pre></div> </li> <li> <p>Define a new float inside your <code>Input</code>. This will be passed from <code>vert</code> to <code>surf</code>.</p> <div class="highlight highlight-glsl"><pre><span class="k">struct</span> <span class="n">Input</span> <span class="p">{</span> <span class="p">...</span> <span class="k">float</span> <span class="n">depth</span><span class="p">;</span> <span class="c1">// &lt;= HERE</span> <span class="p">};</span> </pre></div> </li> <li> <p>Define a <code>vert</code> function like so (skip to step 4 if you already have one):</p> <div class="highlight highlight-glsl"><pre><span class="k">void</span> <span class="n">vert</span><span class="p">(</span><span class="k">inout</span> <span class="n">appdata_full</span> <span class="n">v</span><span class="p">,</span> <span class="k">out</span> <span class="n">Input</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span> <span class="n">UNITY_INITIALIZE_OUTPUT</span><span class="p">(</span><span class="n">Input</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span> <span class="c1">// Unity helper (see UnityCG.cginc for definition)</span> <span class="p">}</span> </pre></div> </li> <li> <p>Use the included helper to calculate the depth of the current vertex and add it to the output:</p> <div class="highlight highlight-glsl"><pre><span class="k">void</span> <span class="n">vert</span><span class="p">(</span><span class="k">inout</span> <span class="n">appdata_full</span> <span class="n">v</span><span class="p">,</span> <span class="k">out</span> <span class="n">Input</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="n">o</span><span class="p">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">CalculateDepth</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span> <span class="c1">// &lt;= HERE</span> <span class="p">}</span> </pre></div> </li> <li> <p>Place <code>IN.depth</code> (calculated in <code>vert</code>) inside your SurfaceOutput's <code>Alpha</code>:</p> <div class="highlight highlight-glsl"><pre><span class="k">void</span> <span class="n">surf</span><span class="p">(</span><span class="n">Input</span> <span class="n">IN</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutput</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="n">o</span><span class="p">.</span><span class="n">Alpha</span> <span class="o">=</span> <span class="n">IN</span><span class="p">.</span><span class="n">depth</span><span class="p">;</span> <span class="c1">// &lt;= HERE</span> <span class="p">}</span> </pre></div> </li> </ol><h4> <a name="user-content-vertex-shaders" class="anchor" href="#vertex-shaders" aria-hidden="true"><span class="octicon octicon-link"></span></a>Vertex Shaders</h4> <ol> <li> <p>Add the DepthCG.cginc include just after your vert/frag pragmas. This will import the necessary helper function for calculating distance from the camera. If you already have includes, DepthCG should be first.</p> <div class="highlight highlight-glsl"><pre><span class="cp">#pragma vertex vert</span> <span class="cp">#pragma fragment frag</span> <span class="cp">#include "DepthCG.cginc" // &lt;= HERE</span> </pre></div> </li> <li> <p>Define depth float to pass to <code>frag</code>:</p> <div class="highlight highlight-glsl"><pre><span class="k">struct</span> <span class="n">v2f</span> <span class="p">{</span> <span class="p">...</span> <span class="k">float</span> <span class="n">depth</span> <span class="o">:</span> <span class="n">TEXCOORD2</span><span class="p">;</span> <span class="c1">// &lt;= HERE</span> <span class="p">};</span> </pre></div> </li> <li> <p>In <code>vert</code>, calculate depth and place it in <code>v2f</code>:</p> <div class="highlight highlight-glsl"><pre><span class="n">v2f</span> <span class="n">vert</span><span class="p">(</span><span class="n">appdata_base</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="n">v2f</span> <span class="n">o</span><span class="p">;</span> <span class="p">...</span> <span class="n">o</span><span class="p">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">CalculateDepth</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span> <span class="c1">// &lt;= HERE</span> <span class="p">...</span> <span class="k">return</span> <span class="n">o</span><span class="p">;</span> <span class="p">}</span> </pre></div> </li> <li> <p>In <code>frag</code>, place the depth calculation from <code>v2f</code> into the output color's alpha channel:</p> <div class="highlight highlight-glsl"><pre><span class="n">half4</span> <span class="n">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">COLOR</span> <span class="p">{</span> <span class="n">half4</span> <span class="n">main_color</span><span class="p">;</span> <span class="p">...</span> <span class="n">main_color</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">depth</span><span class="p">;</span> <span class="c1">// &lt;= HERE</span> <span class="p">...</span> <span class="k">return</span> <span class="n">main_color</span><span class="p">;</span> <span class="p">}</span> </pre></div> </li> </ol><h4> <a name="user-content-transparency" class="anchor" href="#transparency" aria-hidden="true"><span class="octicon octicon-link"></span></a>Transparency</h4> <p>Transparency on mobile is expensive so its best to try and avoid it entirely. Most of the time you can use more polygons cheaper than alpha transparency. Note that the depth of field shader is only compatible with transparent-cutout. Alpha blending won't work without some crazy hacks and its too expensive anyway.</p> <p>For transparent-cutout and depth of field to play nicely you must use a vertex/fragment shader. The transparency shader is otherwise identical to the vertex-fragment shader example with two exceptions:</p> <ol> <li> <p>Make sure the appropriate render tags are set:</p> <div class="highlight highlight-glsl"><pre><span class="n">Tags</span> <span class="p">{</span> <span class="err">"</span><span class="n">Queue</span><span class="err">"</span> <span class="o">=</span> <span class="err">"</span><span class="n">Transparent</span><span class="err">"</span> <span class="err">"</span><span class="n">RenderType</span><span class="err">"</span> <span class="o">=</span> <span class="err">"</span><span class="n">TransparentCutout</span><span class="err">"</span> <span class="p">}</span> </pre></div> </li> <li> <p>Call the <code>clip</code> function in the fragment shader <em>before</em> you override the output alpha with the depth:</p> <div class="highlight highlight-glsl"><pre><span class="c1">// Clip based on the texture alpha</span> <span class="n">clip</span><span class="p">(</span><span class="n">main_color</span><span class="p">.</span><span class="n">a</span> <span class="o">-</span> <span class="mf">0.5</span><span class="n">f</span><span class="p">);</span> <span class="c1">// You can vary the 0.5 if the cutout seems a bit rough</span> <span class="c1">// Place `vert` depth calculation into alpha channel</span> <span class="n">main_color</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">depth</span><span class="p">;</span> </pre></div> </li> </ol><p>An example is include in "Example/Materials/Transparency.mat".</p> <h4> <a name="user-content-terrain" class="anchor" href="#terrain" aria-hidden="true"><span class="octicon octicon-link"></span></a>Terrain</h4> <p>An example of a built-in terrain shader modified to work with the depth of field is included (see "Example/Materials/Tree.mat" or toggle the "Terrain" game object).</p> <p>The changes to apply to the terrain shaders are the same as above. A few things to keep in mind:</p> <ul> <li>Sometimes the vertex function is inside of an external include file such as "SH_Vertex.cginc". You'll need to create your own "SH_Vertex.cginc" (just copy+paste) to override the internal Unity version.</li> <li> <p>In the fragment function make sure that you set the alpha <em>after</em> the clip has been applied:</p> <div class="highlight highlight-glsl"><pre><span class="n">fixed4</span> <span class="n">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="k">input</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_Target</span> <span class="p">{</span> <span class="n">fixed4</span> <span class="n">c</span> <span class="o">=</span> <span class="n">tex2D</span><span class="p">(</span> <span class="n">_MainTex</span><span class="p">,</span> <span class="k">input</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span> <span class="n">c</span><span class="p">.</span><span class="n">rgb</span> <span class="o">*=</span> <span class="mf">2.0</span><span class="n">f</span> <span class="o">*</span> <span class="k">input</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span> <span class="n">clip</span> <span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">a</span> <span class="o">-</span> <span class="n">_Cutoff</span><span class="p">);</span> <span class="c1">// Override alpha, _after_ `clip`</span> <span class="n">c</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="k">input</span><span class="p">.</span><span class="n">depth</span><span class="p">;</span> <span class="c1">// &lt;= HERE</span> <span class="k">return</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span> </pre></div> </li> <li><p>Some terrain shaders use <code>ColorMask RGB</code>. This must be disabled (just remove/comment the line) as it prevents the alpha value from getting passed to the RenderTexture.</p></li> <li>Usually only one of the shader passes needs to be modified. For example, in the example terrain shader, you don't need to modify the "ShadowCaster" pass since its only used for calculating shadows.</li> </ul><h4> <a name="user-content-excluding-meshes" class="anchor" href="#excluding-meshes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Excluding meshes</h4> <p>There are two methods for excluding meshes like GUIs or lens flares from the depth of field. Each approach has different advantages and drawbacks.</p> <p>The first method is to modify the shader you want to be in focus to force the depth to a fixed value outside of the normal range, like <code>-1.0f</code>. For example, in the excluded shader’s <code>surf</code> or <code>frag</code> function setting the alpha value (which holds the real depth value) to <code>-1.0f</code>:</p> <p>With a surface shader:</p> <div class="highlight highlight-glsl"><pre>  <span class="k">void</span> <span class="n">surf</span><span class="p">(</span><span class="n">Input</span> <span class="n">IN</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutput</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ...</span> <span class="n">o</span><span class="p">.</span><span class="n">Alpha</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="n">f</span><span class="p">;</span> <span class="p">}</span> </pre></div> <p>With a vertex/fragment shader:</p> <div class="highlight highlight-glsl"><pre>  <span class="n">half4</span> <span class="n">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">COLOR</span> <span class="p">{</span> <span class="c1">// ...</span> <span class="n">main_color</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="n">f</span><span class="p">;</span> <span class="k">return</span> <span class="n">main_color</span><span class="p">;</span> <span class="p">}</span> </pre></div> <p>See Example/Images/Exclude1.jpg or toggle the "Exclude 1" game object for an example.</p> <p>Note that the cubes are in focus, despite their blurred surroundings.</p> <p>The second method for excluding a mesh from the depth of field requires two cameras. Everything you exclude will be rendered on top of everything else. The benefit to this approach is that there are no bleeding edges like in the first approach and can be useful for GUIs or lens flares.</p> <ol> <li>Create a new layer called “DoF Exclude” by going to Edit &gt; Project Settings &gt; Tags and Layers</li> <li>Assign the objects you want to exclude to this new layer.</li> <li>On your main camera, uncheck “DoF Exclude” from the Culling Mask option. You should see the excluded objects disappear.</li> <li>Create a new camera and parent it under your main camera (so they move together).</li> <li>Set the secondary camera’s Clear Flags to depth only. Since we’ve disabled the Unity depth map on both cameras this camera should always render on top of the main camera.</li> <li>Set the secondary camera’s Culling Mask to only “DoF Exclude”.</li> <li>All other settings should probably match your main camera (such as Field of View, etc.)</li> </ol><p>See Example/Images/Exclude2.jpg or toggle the "Exclude 2" game object and "Main Camera/Exclude Camera" for an example of this approach.</p> <p>Note how the cubes are overlapping everything in the main layer.</p></article></body></html>